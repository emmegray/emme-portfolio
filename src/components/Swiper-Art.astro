---
import { Swiper, SwiperWrapper, SwiperSlide, SwiperButtonPrev, SwiperButtonNext } from "astro-swiper";
import { data } from "../content/data"
import { Image } from 'astro:assets';

const images = data.Works.Arts;
const thumbnails = data.Works.Arts.map((item) => item.thumbnail ?? item.src);
---

<Swiper
  uniqueClass="swiper-art"
  linkToThumbUniqueClass="swiper-art-thumbnail"
  options={{
    zoom: true,
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    loop: true,
    autoplay: {
      delay: 10000,
      disableOnInteraction: false,
      waitForTransition: false,
    },
  }}
>
  <SwiperWrapper>
    {
      images.map((image, idx) => (
        <SwiperSlide>
            <Image  class="imgArt"
              src={image.src}
              alt={image.alt}
              loading="lazy"
              style="cursor:zoom-in;"
              data-title={image.title ?? ""}
              data-description={image.description ?? ""}
              data-year={image.year ?? ""}
              data-tool={image.tool ?? ""}
              layout='constrained' width={400} height={259} />
        </SwiperSlide>
      ))
    }
  </SwiperWrapper>
  <SwiperButtonPrev />
  <SwiperButtonNext />
</Swiper>

<Swiper
  uniqueClass="swiper-art-thumbnail"
  options={{
    spaceBetween: 10,
    slidesPerView: 4,
    freeMode: true,
    watchSlidesProgress: true,
    loop: true,
  }}
>
  <SwiperWrapper>
    {
      thumbnails.map((thumb, idx) => (
        <SwiperSlide>
          <Image src={thumb}  alt="Art thumbnails"
              loading="lazy"
              layout='constrained' width={90} height={90} loading="lazy" />
        </SwiperSlide>
      ))
    }
  </SwiperWrapper>
</Swiper>

<div id="artImagePopup" class="image-popup" style="display:none;">
  <img id="artPopupImg" src="" alt="" />
  <button id="artPopupClose" type="button">X</button>
</div>

<script type="text/javascript">

  function setupArtPopup() {
    const popup = document.getElementById('artImagePopup');
    const popupImg = document.getElementById('artPopupImg');
    const popupInfo = document.getElementById('artPopupInfo');
    const popupClose = document.getElementById('artPopupClose');
    const swiperArt = document.querySelector('.swiper-art');

    if (!swiperArt) {
      setTimeout(setupArtPopup, 100);
      return;
    }

    swiperArt.addEventListener('click', function(e) {
      const img = e.target.closest('.imgArt');
      if (img) {
        popup.style.display = "flex";
        popupImg.src = img.src;
        popupImg.alt = img.alt;

        let infoHtml = "<ul>";
        if (img.dataset.title) infoHtml += `<li>${img.dataset.title}</li>`;
        if (img.dataset.description) infoHtml += `<li>${img.dataset.description}</li>`;
        if (img.dataset.year) infoHtml += `<li>${img.dataset.year}</li>`;
        if (img.dataset.tool) infoHtml += `<li>${img.dataset.tool}</li>`;
        infoHtml += "</ul>";
        popupInfo.innerHTML = infoHtml;
      }
    });

    popupClose.onclick = function(e) {
      e.stopPropagation();
      popup.style.display = "none";
    };

    popup.onclick = function(e) {
      if (e.target === popup) popup.style.display = "none";
    };
  }

  document.addEventListener("DOMContentLoaded", setupArtPopup);
</script>